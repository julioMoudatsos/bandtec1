<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Projeto IoT - Sobre</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/contato-e-login.css">
</head>

<body>

  <div class="contato">
    <div class="container">
      <h1>Faça aqui seu cadastro!</h1>
      <div class="formulario">
        <form id="form_cadastro2" method="post" onsubmit="return cadastrar2()">
          Email
          <input type="text" name="email_testando" class="input-padrao" autofocus="autofocus" placeholder="Email"
            required minlength="4">

          Login
          <input type="text" name="login_testando" class="input-padrao" placeholder="seu nome de usuário" required
            minlength="4">

          Senha
          <input type="password" name="senha_testando" class="input-padrao" placeholder="***************" required
            minlength="4">

          <input " type=" text" id="fk_tesntando" name="fk_tesntando">

          <input type="submit" id="btn_entrar" value="Cadastrar" class="btn-green">
        </form>

        <img src="aguarde-orange.gif" id="img_aguarde" style="display: none; width:100px">

        <div id="div_erro" style="background-color: sandybrown; color: maroon; display: none;">
          Erro no cadastro
        </div>

      </div>
      <div class="imagem-lateral">
        <img src="img/side-img-contato_orange.jpg">
      </div>
    </div>
  </div>




</body>

</html>

<script>
  window.onload = function () {
    fk_tesntando.value = sessionStorage.id_usuario_meuapp;
    fk_tesntando.setAttribute("value", sessionStorage.id_usuario_meuapp);
    console.log(fk_tesntando)
  };
  function cadastrar2() {

    aguardar2();
    var formulario = new URLSearchParams(new FormData(form_cadastro2));
    fetch("/usuarios/cadastrar2", {
      method: "POST",
      body: formulario
    }).then(function (response) {

      if (response.ok) {

        window.location.href = 'testelog.html';

      } else {

        console.log('Erro de cadastro!');
        response.text().then(function (resposta) {
          div_erro.innerHTML = resposta;
        });
        finalizar_aguardar2();
      }
    });

    return false;
  }

  function aguardar2() {
    btn_entrar.disabled = true;
    img_aguarde.style.display = 'block';
    div_erro.style.display = 'none';
  }

  function finalizar_aguardar2() {
    btn_entrar.disabled = false;
    img_aguarde.style.display = 'none';
    div_erro.style.display = 'block';
  }

</script>